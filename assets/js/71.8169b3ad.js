(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{472:function(e,t,a){"use strict";a.r(t);var s=a(23),c=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"let-s-encrypt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt"}},[e._v("#")]),e._v(" Let's Encrypt")]),e._v(" "),a("p",[e._v("新安裝好的 Proxmox VE 是有 SSL 憑證的，由於是自簽憑證，所以瀏覽器都會出現警告視窗，很幸運的現在有 Let's Encrypt 免費憑證可以申請，Proxmox 官方的 "),a("a",{attrs:{href:"https://pve.proxmox.com/wiki/HTTPS_Certificate_Configuration_(Version_4.x_and_newer)",target:"_blank",rel:"noopener noreferrer"}},[e._v("wiki"),a("OutboundLink")],1),e._v(" 也有使用說明，基本上照著說明走就可以了。")]),e._v(" "),a("h2",{attrs:{id:"系統需求-對外-80-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系統需求-對外-80-port"}},[e._v("#")]),e._v(" 系統需求 - 對外 80 Port")]),e._v(" "),a("p",[e._v("是的，你的 Proxmox VE 一定需要有辦法讓外面的機器連到你的 80 Port，簡單安全的方法是直接讓 Router 作 Port forwarding 80到80，以便 Let's Encrypt 的伺服器對你的主機進行認證並配發 SSL 憑證。")]),e._v(" "),a("h2",{attrs:{id:"開始安裝"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#開始安裝"}},[e._v("#")]),e._v(" 開始安裝")]),e._v(" "),a("p",[e._v("在開啟前，請先把 console 切到 root ，便於操作，不信任自己雙手的就用 "),a("code",[e._v("sudo")]),e._v(" 吧。")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("安裝 acme.sh ("),a("a",{attrs:{href:"https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"}},[e._v("acme.sh 中文說明"),a("OutboundLink")],1),e._v(")\n在這邊我使用"),a("code",[e._v("git")]),e._v("取得最新的 acme.sh")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("git clone https://github.com/Neilpang/acme.sh.git acme.sh-master\n")])])])]),e._v(" "),a("li",[a("p",[e._v("執行腳本")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('EMAIL=你的email@gmail.com\nmkdir /etc/pve/.le\ncd /root/acme.sh-master\n./acme.sh --install --accountconf /etc/pve/.le/account.conf --accountkey /etc/pve/.le/account.key --accountemail "$EMAIL"\n')])])])]),e._v(" "),a("li",[a("p",[e._v("檢查帳號相關設定")]),e._v(" "),a("ul",[a("li",[e._v("打開 "),a("code",[e._v("/etc/pve/.le/account.conf")]),e._v("。")]),e._v(" "),a("li",[e._v("檢查 "),a("code",[e._v("ACCOUNT_EMAIL")]),e._v(" 是否為自己的 Email 。")]),e._v(" "),a("li",[e._v("檢查 "),a("code",[e._v("ACCOUNT_KEY_PATH")]),e._v(" 是否設為 "),a("code",[e._v("/etc/pve/.le/account.key")]),e._v("。")])])]),e._v(" "),a("li",[a("p",[e._v("打開 Proxmox VE 的 80 Port\n如果在前一章 "),a("RouterLink",{attrs:{to:"/devops/proxmoxve/01/doc/02.settings.firewall.html"}},[e._v("防火牆設定")]),e._v(" 有確實設定的話，記得把 80 Port 打開，讓外部主機可以連入。")],1)])]),e._v(" "),a("h2",{attrs:{id:"申請憑證"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#申請憑證"}},[e._v("#")]),e._v(" 申請憑證")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("測試")]),e._v(" "),a("p",[e._v("使用以下指令測試看看，主機是否能正確連線：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('DOMAIN=pve.example.com\n./acme.sh --issue --standalone --keypath /etc/pve/local/pveproxy-ssl.key --fullchainpath /etc/pve/local/pveproxy-ssl.pem --reloadcmd "systemctl restart pveproxy" -d $DOMAIN --test\n')])])])]),e._v(" "),a("li",[a("p",[e._v("申請")]),e._v(" "),a("p",[e._v("確定可以正常跑完成序後，就可以進行申請了，把 "),a("code",[e._v("--test")]),e._v(" 參數拿掉即可：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('DOMAIN=pve.example.com\n./acme.sh --issue --standalone --keypath /etc/pve/local/pveproxy-ssl.key --fullchainpath /etc/pve/local/pveproxy-ssl.pem --reloadcmd "systemctl restart pveproxy" -d $DOMAIN \n')])])])]),e._v(" "),a("li",[a("p",[e._v("強制更新憑證\n當網域有變更的時候就需要使用了，或是憑證出問題時，加上 ```--force`` 參數可以強制更新憑證。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('DOMAIN=pve.example.com\n./acme.sh --issue --standalone --keypath /etc/pve/local/pveproxy-ssl.key --fullchainpath /etc/pve/local/pveproxy-ssl.pem --reloadcmd "systemctl restart pveproxy" -d $DOMAIN --force\n')])])])])]),e._v(" "),a("h2",{attrs:{id:"檢查-crontab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#檢查-crontab"}},[e._v("#")]),e._v(" 檢查 crontab")]),e._v(" "),a("p",[e._v("申請完畢後，腳本已經自動把更新憑證加入 crontab 之中了，可以使用 "),a("code",[e._v("crontab -l")]),e._v(" 來查閱：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('0 0 * * *“/root/.acme.sh"/acme.sh --cron --home”/root/.acme.sh“> / dev / null\n')])])]),a("h2",{attrs:{id:"關掉防火牆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#關掉防火牆"}},[e._v("#")]),e._v(" 關掉防火牆")]),e._v(" "),a("p",[e._v("申請完 Let's Encrypt 憑證後記得把 80 Port 關掉。")]),e._v(" "),a("h2",{attrs:{id:"更新-acme-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新-acme-sh"}},[e._v("#")]),e._v(" 更新 acme.sh")]),e._v(" "),a("p",[e._v("因為是使用 "),a("code",[e._v("git clone")]),e._v(" 下來的，要更新也很簡單：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('cd /root/acme.sh-master\ngit pull\n./acme.sh --install --accountconf /etc/pve/.le/account.conf --accountkey /etc/pve/.le/account.key --accountemail "YOUR@EMAIL.ADDRESS"\n')])])])])}),[],!1,null,null,null);t.default=c.exports}}]);