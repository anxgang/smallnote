(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{417:function(t,a,e){"use strict";e.r(a);var r=e(23),s=Object(r.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"certbot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#certbot"}},[t._v("#")]),t._v(" Certbot")]),t._v(" "),e("blockquote",[e("p",[t._v("使用 Certbot 自動更新免費 SSL 證書")])]),t._v(" "),e("h2",{attrs:{id:"一、-說明及安裝"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、-說明及安裝"}},[t._v("#")]),t._v(" 一、 說明及安裝")]),t._v(" "),e("p",[t._v("Let's Encrypt: 是發行免費 SSL 證書的機構，每次申請三個月後會過期，但可以續約。")]),t._v(" "),e("p",[t._v("Certbot: 是一個方便更新 Let's Encrypt 的軟體，並可以設定排程自動續約。")]),t._v(" "),e("p",[t._v("本教學是說明如何以 Certbot 去申請 Let's Encrypt 核發 SSL 證書的教學")]),t._v(" "),e("h5",{attrs:{id:"使用環境如下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用環境如下"}},[t._v("#")]),t._v(" 使用環境如下")]),t._v(" "),e("ol",[e("li",[t._v("Ubuntu 18.04")]),t._v(" "),e("li",[t._v("Nginx 1.10.3")])]),t._v(" "),e("h3",{attrs:{id:"_1-安裝相關套件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安裝相關套件"}},[t._v("#")]),t._v(" 1. 安裝相關套件")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo apt-get update\n$ sudo apt-get install software-properties-common\n$ sudo add-apt-repository universe\n$ sudo add-apt-repository ppa:certbot/certbot\n$ sudo apt-get update\n$ sudo apt-get install certbot python-certbot-nginx\n")])])]),e("h2",{attrs:{id:"二、-啟用單一網域-xxx-domain-com"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、-啟用單一網域-xxx-domain-com"}},[t._v("#")]),t._v(" 二、 啟用單一網域(xxx.domain.com)")]),t._v(" "),e("blockquote",[e("p",[t._v("如要啟用 *.domain.com 請跳到『三』")])]),t._v(" "),e("h3",{attrs:{id:"_1-註冊"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-註冊"}},[t._v("#")]),t._v(" 1. 註冊")]),t._v(" "),e("h4",{attrs:{id:"狀況1-讓-certbot申請好，並自動寫入-nginx-conf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#狀況1-讓-certbot申請好，並自動寫入-nginx-conf"}},[t._v("#")]),t._v(" 狀況1. 讓 certbot申請好，並自動寫入 nginx.conf")]),t._v(" "),e("p",[t._v("適用在 nginx.conf ssl 還沒寫")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo certbot --nginx\n")])])]),e("h4",{attrs:{id:"狀況2-讓-certbot-申請好就好，不寫入到-nginx-conf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#狀況2-讓-certbot-申請好就好，不寫入到-nginx-conf"}},[t._v("#")]),t._v(" 狀況2. 讓 certbot 申請好就好，不寫入到 nginx.conf")]),t._v(" "),e("p",[t._v("適用在 nginx.conf ssl 已經寫好了的時候")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo certbot --nginx certonly\n")])])]),e("h3",{attrs:{id:"_2-自動續訂"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-自動續訂"}},[t._v("#")]),t._v(" 2. 自動續訂")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("sudo certbot renew --dry-run\n")])])]),e("h2",{attrs:{id:"三、-啟用複數網域-domain-com"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、-啟用複數網域-domain-com"}},[t._v("#")]),t._v(" 三、 啟用複數網域(*.domain.com)")]),t._v(" "),e("h3",{attrs:{id:"_1-安裝外掛"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安裝外掛"}},[t._v("#")]),t._v(" 1. 安裝外掛")]),t._v(" "),e("blockquote",[e("p",[t._v("這邊使用 cloudflare 當範例 (官方還有提供其他 plugin)")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo apt install python3-pip\n$ sudo pip3 install certbot-dns-cloudflare\n")])])]),e("h3",{attrs:{id:"_2-取得-api-key"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-取得-api-key"}},[t._v("#")]),t._v(" 2. 取得 api key")]),t._v(" "),e("p",[t._v("通常放在 "),e("a",{attrs:{href:"https://dash.cloudflare.com/profile",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloudflare profile"),e("OutboundLink")],1),t._v(" 沒有就建立一個 (Global API Key)")]),t._v(" "),e("p",[t._v("到主機上面建立 "),e("code",[t._v("~/.secrets/cloudflare.ini")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo mkdir ~/.secrets/\n$ sudo vim ~/.secrets/cloudflare.ini\n")])])]),e("p",[t._v("並填入下面內容")]),t._v(" "),e("blockquote",[e("p",[t._v("請換成自己的 email 和 api key")])]),t._v(" "),e("h6",{attrs:{id:"secrets-cloudflare-ini"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secrets-cloudflare-ini"}},[t._v("#")]),t._v(" ~/.secrets/cloudflare.ini")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('dns_cloudflare_email = "youremail@example.com"\ndns_cloudflare_api_key = "4003c330b45f4fbcab420eaf66b49c5cbcab4"\n')])])]),e("h3",{attrs:{id:"_3-註冊"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-註冊"}},[t._v("#")]),t._v(" 3. 註冊")]),t._v(" "),e("blockquote",[e("p",[t._v("*.domain.com 請換成自己的domain")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo certbot certonly \\\n  --dns-cloudflare \\\n  --dns-cloudflare-credentials ~/.secrets/cloudflare.ini \\\n  -d domain.com,*.domain.com \\\n  --preferred-challenges dns-01\n")])])]),e("h3",{attrs:{id:"_4-自動續訂"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-自動續訂"}},[t._v("#")]),t._v(" 4. 自動續訂")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("sudo certbot renew --dry-run\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("參考")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://bjornjohansen.no/wildcard-certificate-letsencrypt-cloudflare",target:"_blank",rel:"noopener noreferrer"}},[t._v("Wildcard certificate from Let’s Encrypt with CloudFlare DNS"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://community.letsencrypt.org/t/unrecognized-arguments-dns-cloudflare-credentials/60996",target:"_blank",rel:"noopener noreferrer"}},[t._v("Unrecognized arguments: –dns-cloudflare-credentials"),e("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=s.exports}}]);