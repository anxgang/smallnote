(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{353:function(a,s,t){a.exports=t.p+"assets/img/01.5991f26e.png"},354:function(a,s,t){a.exports=t.p+"assets/img/02.57ec0a16.png"},355:function(a,s,t){a.exports=t.p+"assets/img/03.ce7a8d1f.png"},356:function(a,s,t){a.exports=t.p+"assets/img/04.b8760535.png"},357:function(a,s,t){a.exports=t.p+"assets/img/05.ccd48b2f.png"},358:function(a,s,t){a.exports=t.p+"assets/img/06.70fdab75.png"},359:function(a,s,t){a.exports=t.p+"assets/img/07.a7ac384d.png"},360:function(a,s,t){a.exports=t.p+"assets/img/08.a6d777fe.png"},361:function(a,s,t){a.exports=t.p+"assets/img/09.0a2618f5.png"},362:function(a,s,t){a.exports=t.p+"assets/img/10.352714a2.png"},463:function(a,s,t){"use strict";t.r(s);var r=t(23),e=Object(r.a)({},(function(){var a=this,s=a.$createElement,r=a._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h1",{attrs:{id:"系統安裝-進階"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#系統安裝-進階"}},[a._v("#")]),a._v(" 系統安裝(進階)")]),a._v(" "),r("p",[a._v("此為進階使用者的安裝方式，適合進階實務使用，請準備 2 個 USB3.0 的隨身碟，本例中將使用隨身碟作為 Raid1 的系統磁區。\n此範例中硬碟分配為:")]),a._v(" "),r("ol",[r("li",[a._v("2 個 8GB 硬碟(模擬為 USB3.0 隨身碟)")]),a._v(" "),r("li",[a._v("1 個 16GB 硬碟(模擬為一般硬碟)")])]),a._v(" "),r("h2",{attrs:{id:"一、系統安裝"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一、系統安裝"}},[a._v("#")]),a._v(" 一、系統安裝")]),a._v(" "),r("ul",[r("li",[r("p",[a._v("使用 "),r("strong",[a._v("USB開機碟")]),a._v(" 進行開機：")]),a._v(" "),r("img",{attrs:{src:t(353),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("同意使用條款")]),a._v(" "),r("img",{attrs:{src:t(354),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("點擊 "),r("strong",[a._v("Options")]),a._v(" ，這邊我們選用 zfs 作為 rootfs")]),a._v(" "),r("img",{attrs:{src:t(355),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("此範例中有 2 個隨身碟，選擇 zfs 的 Raid1 軟體陣列以確保資料安全")]),a._v(" "),r("img",{attrs:{src:t(356),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("壓縮模式選擇 "),r("strong",[a._v("lz4")]),a._v(" 較為快速，也吃比較少資源")]),a._v(" "),r("img",{attrs:{src:t(357),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("時區、國家、語言設定，通常只會修改時間跟國家的選項")]),a._v(" "),r("img",{attrs:{src:t(358),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("設定 root 的密碼以及管理者的 email")]),a._v(" "),r("img",{attrs:{src:t(359),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("設定 IP，請依照主機的網路環境進行修改")]),a._v(" "),r("img",{attrs:{src:t(360),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("因為使用隨身碟，安裝系統可能需要一點時間")]),a._v(" "),r("img",{attrs:{src:t(361),width:"70%"}}),a._v(" "),r("br"),r("br")]),a._v(" "),r("li",[r("p",[a._v("安裝完畢，重新啟動")]),a._v(" "),r("img",{attrs:{src:t(362),width:"70%"}}),a._v(" "),r("br"),r("br")])]),a._v(" "),r("h2",{attrs:{id:"二、-usb-優化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二、-usb-優化"}},[a._v("#")]),a._v(" 二、 USB 優化")]),a._v(" "),r("p",[a._v("因為 Proxmox VE 內某些資料夾會經常讀取，隨身碟可能會不堪負荷，壽命減短，而且速度也不優，本例將以一個 16 GB 大小的 zpool 當作 HDD ，將以下資料夾掛載到 HDD pool 之中:")]),a._v(" "),r("p",[r("em",[a._v("Reference : "),r("a",{attrs:{href:"https://goo.gl/j4mTdx",target:"_blank",rel:"noopener noreferrer"}},[a._v("Proxmox VE 伺服器虛擬化管理平台 使用者社團"),r("OutboundLink")],1)])]),a._v(" "),r("p",[r("code",[a._v("swap")]),a._v(" "),r("code",[a._v("/var/lib/vz")]),a._v(" "),r("code",[a._v("/var/cache")]),a._v(" "),r("code",[a._v("/var/log")])]),a._v(" "),r("ul",[r("li",[r("p",[a._v("直接使用 SSH 連線進入 Proxmox VE 主機，使用"),r("code",[a._v("fdisk -l")]),a._v("查詢傳統硬碟 :")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# fdisk -l\n\nDisk /dev/sdc: 16 GiB, 17179869184 bytes, 33554432 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/zd0: 896 MiB, 939524096 bytes, 1835008 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 4096 bytes\nI/O size (minimum/optimal): 4096 bytes / 4096 bytes\n\n")])])])]),a._v(" "),r("li",[r("p",[a._v("建立 zpool :")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# zpool create HardDisk /dev/sdc\n\nroot@pve:~# zpool status\n  pool: HardDisk\n state: ONLINE\n  scan: none requested\nconfig:\n\n        NAME        STATE     READ WRITE CKSUM\n        HardDisk    ONLINE       0     0     0\n        sdc       ONLINE       0     0     0\n\nerrors: No known data errors\n\n  pool: rpool\n state: ONLINE\n  scan: none requested\nconfig:\n\n        NAME        STATE     READ WRITE CKSUM\n        rpool       ONLINE       0     0     0\n          mirror-0  ONLINE       0     0     0\n            sda2    ONLINE       0     0     0\n            sdb2    ONLINE       0     0     0\n\nerrors: No known data errors\n")])])])]),a._v(" "),r("li",[r("p",[a._v("建立 dataset")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# zfs create HardDisk/cache\nroot@pve:~# zfs create HardDisk/cache/vz\nroot@pve:~# zfs create HardDisk/cache/cache\nroot@pve:~# zfs create HardDisk/cache/log\nroot@pve:~# zfs list \nNAME                   USED  AVAIL  REFER  MOUNTPOINT\nHardDisk               166K  15.4G    19K  /HardDisk\nHardDisk/cache          95K  15.4G    19K  /HardDisk/cache\nHardDisk/cache/cache    19K  15.4G    19K  /HardDisk/cache/cache\nHardDisk/cache/log      19K  15.4G    19K  /HardDisk/cache/log\nHardDisk/cache/vz       19K  15.4G    19K  /HardDisk/cache/vz\nrpool                 1.63G  6.06G    96K  /rpool\nrpool/ROOT             714M  6.06G    96K  /rpool/ROOT\nrpool/ROOT/pve-1       714M  6.06G   714M  /\nrpool/data              96K  6.06G    96K  /rpool/data\nrpool/swap             953M  6.99G    64K  -\n")])])])]),a._v(" "),r("li",[r("p",[a._v("使用 zfs 建立 swap，容量依據自身需求調整")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# zfs create -V 8G HardDisk/swap\nroot@pve:~# mkswap /dev/zvol/HardDisk/swap\nSetting up swapspace version 1, size = 8388604 KiB\nno label, UUID=9c239646-d67a-4ea6-b56a-aabc04ffb9c7\n")])])])]),a._v(" "),r("li",[r("p",[a._v("修改 "),r("code",[a._v("/etc/fstab")]),a._v("，將原本在 USB 內的 swap 換成新的路徑")])]),a._v(" "),r("li",[r("p",[a._v("修改剛剛建立的 zfs 之掛載點")]),a._v(" "),r("ul",[r("li",[r("p",[r("code",[a._v("/var/lib/vz")])]),a._v(" "),r("p",[a._v("移動資料夾內的東西到新的 dataset 中，這樣才有辦法修改掛載點")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# rsync -avx /var/lib/vz/* /HardDisk/cache/vz\nroot@pve:~# zfs set mountpoint=/var/lib/vz HardDisk/cache/vz\n")])])])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/var/cache")])]),a._v(" "),r("p",[a._v("移動資料夾內的東西到新的 dataset 中，這樣才有辦法修改掛載點")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# rsync -avx /var/cache/* /HardDisk/cache/cache\nroot@pve:~# zfs set mountpoint=/var/cache HardDisk/cache/cache\n")])])])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/var/log")])]),a._v(" "),r("p",[a._v("移動資料夾內的東西到新的 dataset 中，這樣才有辦法修改掛載點")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# rsync -avx /var/log/* /HardDisk/cache/log\nroot@pve:~# zfs set mountpoint=/var/log HardDisk/cache/log\n")])])])])])]),a._v(" "),r("li",[r("p",[a._v("重新啟動，成功移動常讀寫的資料夾到 HHD 中，記得把原本 rpool 內的 swap 刪掉")]),a._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("root@pve:~# zfs list \nNAME                   USED  AVAIL  REFER  MOUNTPOINT\nHardDisk              8.25G  7.13G    19K  /HardDisk\nHardDisk/cache         805K  7.13G    19K  /HardDisk/cache\nHardDisk/cache/cache    19K  7.13G    19K  /var/cache\nHardDisk/cache/log     748K  7.13G   748K  /var/log\nHardDisk/cache/vz       19K  7.13G    19K  /var/lib/vz\nHardDisk/swap         8.25G  15.4G    16K  -\nrpool                 1.63G  6.06G    96K  /rpool\nrpool/ROOT             710M  6.06G    96K  /rpool/ROOT\nrpool/ROOT/pve-1       710M  6.06G   710M  /\nrpool/data              96K  6.06G    96K  /rpool/data\n")])])])])]),a._v(" "),r("h2",{attrs:{id:"rootdelay"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rootdelay"}},[a._v("#")]),a._v(" rootdelay")]),a._v(" "),r("p",[a._v("因為使用的是 USB 作為 rootfs ，可能在還沒掛載完畢 (root)，系統就進行開機，導致開機失敗，可以修改 grub 設定，延長開機時間來避免這個狀況發生")])])}),[],!1,null,null,null);s.default=e.exports}}]);